{% extends "base.html" %}
{% block content %}
    <div class="form-container">
        <h1>Create New Election</h1>
        <form method="POST" action="">
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.title.label }}
                {{ form.title(class="form-control") }}
                {% for error in form.title.errors %}
                    <span class="error-message">{{ error }}</span>
                {% endfor %}
            </div>
            <div class="form-group">
                {{ form.description.label }}
                {{ form.description(class="form-control", rows=5) }}
                {% for error in form.description.errors %}
                    <span class="error-message">{{ error }}</span>
                {% endfor %}
            </div>
            <h2>Candidates</h2>
            <div id="candidates-container">
                {% for candidate_field in form.candidates %}
                    <div class="form-group candidate-field">
                        {{ candidate_field.name.label }}
                        {{ candidate_field.name(class="form-control") }}
                        {% for error in candidate_field.name.errors %}
                            <span class="error-message">{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
            <button type="button" id="add-candidate" class="btn btn-secondary">Add Candidate</button>
            <button type="button" id="remove-candidate" class="btn btn-danger">Remove Last Candidate</button>
            <br><br>
            {{ form.submit(class="btn btn-primary") }}
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var container = document.getElementById('candidates-container');

            document.getElementById('add-candidate').addEventListener('click', function() {
                var index = container.children.length; 
                if (index < 10) { 
                    var newField = document.createElement('div');
                    newField.className = 'form-group candidate-field';
                    newField.innerHTML = `
                        <label for="candidates-${index}-name">Candidate Name</label>
                        <input class="form-control" id="candidates-${index}-name" name="candidates-${index}-name" type="text" value="" required>
                    `;
                    container.appendChild(newField);
                } else {
                    alert('Maximum 10 candidates allowed.');
                }
            });

            document.getElementById('remove-candidate').addEventListener('click', function() {
                if (container.children.length > 2) { 
                    container.removeChild(container.lastChild);
                } else {
                    alert('Must have at least 2 candidates.');
                }
            });
        });
    </script>
