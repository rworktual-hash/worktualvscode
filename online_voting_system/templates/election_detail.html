{% extends "base.html" %}
{% block content %}
    <div class="election-detail-container">
        <h1>{{ election.title }}</h1>
        <p class="election-description">{{ election.description }}</p>
        <p>Status: {% if election.is_active %}Active{% else %}Inactive{% endif %}</p>

        <h2>Candidates</h2>
        <ul class="candidate-list">
            {% for candidate in candidates %}
                <li>{{ candidate.name }}</li>
            {% endfor %}
        </ul>

        {% if get_current_user() %}
            {% if election.is_active %}
                {% if user_voted %}
                    <div class="alert alert-info">You have already voted in this election.</div>
                    <a href="{{ url_for('election_results', election_id=election.id) }}" class="btn btn-secondary">View Results</a>
                {% else %}
                    <h2>Cast Your Vote</h2>
                    <form method="POST" action="{{ url_for('cast_vote', election_id=election.id) }}">
                        {{ form.hidden_tag() }}
                        <div class="form-group">
                            {% for subfield in form.candidate %}
                                <div class="radio-option">
                                    {{ subfield }}
                                    {{ subfield.label }}
                                </div>
                            {% endfor %}
                            {% for error in form.candidate.errors %}
                                <span class="error-message">{{ error }}</span>
                            {% endfor %}
                        </div>
                        {{ form.submit(class="btn btn-primary") }}
                    </form>
                {% endif %}
            {% else %}
                <div class="alert alert-warning">This election is no longer active.</div>
            {% endif %}
        {% else %}
            <div class="alert alert-warning">Please <a href="{{ url_for('login') }}">log in</a> to cast your vote.</div>
        {% endif %}
        <br>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Elections</a>
    </div>
{% endblock %}
